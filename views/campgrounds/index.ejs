<% layout('layouts/boilerplate') -%>

<% block('head').append('   <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">') %>
<% block('head').append("   <script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>") %>
<% block('head').append("   <link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />") %>
<% block('head').append("   <link rel='stylesheet' href='/campgrounds/stylesheets/index.css'>") %>


<div class="container-fluid mb-5" id="map"></div>
<form action="/campgrounds" class="search-form container mb-5 offset-md-2">
    <div class="row">
        <div class="col-md-6 mb-3">
            <input type="search" placeholder="Search For Campground Title Or Location" class="form-control"
                name="search">
        </div>
        <div class="col-md-2 mb-3">
            <select id="" class="form-select form-control" name="sort">
                <option value="" default>Sort By</option>
                <option value="rating">Rating</option>
                <option value="price">Price</option>
            </select>
        </div>
        <div class="col-md-4 mb-3">
            <button class="btn btn-success">Search</button>
        </div>
    </div>
</form>

<% if (searchTerm){ %>
<% if (campgrounds.length>0){ %>
<h1 class="text-center">Search Results For <%= searchTerm %></h1>
<% } else{ %>
<h1 class="text-center">No Results Found For <%= searchTerm %></h1>
<% } %>
<% } else{ %>
<h1 class="text-center">All CampGrounds</h1>
<% } %>

<div class="container d-flex flex-wrap campgrounds mt-5">
    <% for (let campground of campgrounds){%>
    <div class="card mb-3 shadow">
        <img src="<%= campground.images.length>0?campground.images[0].thumb: "https://st3.depositphotos.com/25155840/37294/v/600/depositphotos_372944400-stock-illustration-text-image-available-circle-icon.jpg" %>"
            class="card-img-top" alt="...">
        <div class="card-body">
            <h5 class="card-title d-inline-block"><%= campground.title %></h5>
            <h5 class="card-title showprice d-inline"><i
                    class="fas fa-dollar-sign me-2"></i><%= campground.price %>/night</h5>
            <p class="card-text average-rating">
                <% for (let i=1; i<=Math.round(campground.avg_rating); i++) {%>
                <i class="fas fa-star avg-rated-star"></i>
                <% } %>
                <% for(let j=1; j<=(5-Math.round(campground.avg_rating)); j++){ %>
                <i class="far fa-star avg-rated-star"></i>
                <% } %>
                <p class="text-muted"><%= campground.reviews.length %> Reviews</p>
            </p>
            <p class="card-text">
                <small class="text-muted"><i
                        class="fas fa-globe me-2 text-primary"></i><%= campground.location%></small>
            </p>
        </div>
        <div class="card-body">
            <a class="btn btn-primary" href="/campgrounds/<%=campground._id%>">View <%=campground.title%></a>
        </div>
    </div>
    <% }%>
</div>
<script>
    const Mapbox_Token = `<%- process.env.MAPBOX_TOKEN %>`
</script>
<script src="/campgrounds/javascripts/clusterMap.js"></script>